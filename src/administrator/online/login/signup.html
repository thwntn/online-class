<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./assets/style/login.css">
    <link rel="stylesheet" href="./assets/style/signup.css">
    <link rel="stylesheet" href="./assets/framework/css/bootstrap.css">
    <script src='./assets/framework/js/bootstrap.js'></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Varela+Round&display=swap" rel="stylesheet">

    <!-- Font Awaresome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    
    <!-- MD5 -->
    <script src="./assets/js/md5.js"></script>
</head>

<body>
    <div id="root">
        <div class="container-fluid">
            <div class="frame row">
                <div class="content col-md-8">
                    <h2>Đăng kí</h2>
                    <h5>Tên đăng nhập</h5>
                    <label class="username_err"></label>
                    <input class="username" type="text" placeholder="Tên tài khoản hoặc email">
                    <h5>Mật khẩu</h5>
                    <label class="password_err"></label>
                    <input class="password" type='password' placeholder="Nhập mật khẩu">
                    <h5>Tên đầy đủ</h5>
                    <label class="fullname_err"></label>
                    <input class="fullname" type='text' placeholder="Nhập tên đầy đủ">
                    <h5>Địa chỉ</h5>
                    <label class="address_err"></label>
                    <input class="address" type='text' placeholder="Nhập địa chỉ">
                    <h5>Số điện thoại</h5>
                    <label class="phone_err"></label>
                    <input class="phone" type='text' placeholder="Nhập số điện thoại">
                    <h5>Email</h5>
                    <label class="email_err"></label>
                    <input class="email" type='text' placeholder="Nhập email">
                    <h5>Giới tính</h5>
                    <div class="sex">
                        <button class="choose-sex" data = 1>Nam</button>
                        <button class="choose-sex" data = 2>Nữ</button>
                        <button class="choose-sex" data = 0>Khác</button>
                    </div>
                    <h5>Ngành học</h5>
                    <label class="major_err"></label>
                    <input class="major" type='pasword' placeholder="Nhập ngành học">
                    <h5>Loại tài khoản đăng kí</h5>
                    <div class="type">
                        <button class="choose-type" data = 2>Giáo viên</button>
                        <button class="choose-type" data = 1>Học sinh</button>
                    </div>
                    <h5>Ảnh đại diện</h5>
                    <input class="upload" type='file'>
                    <p class="choose-file">Chưa chọn file</p>
                    <button class="submit">Đăng kí</button>
                </div>
            </div>
        </div>
        <div class="capcha">
            <input type="text" placeholder="Vui lòng nhập mã xác thực được gửi đến mail của bạn!">
        </div>
        <div class="err">
            <div class="err_warning">
                <i class="fas fa-exclamation flex"></i>
                <h5>Vui lòng điền đầy đủ thông tin</h5>
            </div>
        </div>
    </div>
</body>
<script>
    const information = {
        status: false,
        data: {
            username: null,
            password: null,
            fullname: null,
            address: null,
            phone: null,
            email: null,
            major: null,
            gendle: null,
            type: null,
            image: 'abc'
        },

        isLetter: (string) => {
            return string.toLowerCase() != string.toUpperCase()
        },

        check: function() {
            console.log(this.isLeter);

        },

        checkString: function() {
            for (char of this.data.username) {
                if(!this.isLetter(char)) {
                    return false
                }
            }
            return true
        },

        finalCheck: function() {
            for (const [key, value] of Object.entries(this.data)) {
                if(value == null || value == '') return false
            }
            return true
        },

        setData: function(key, value) {
            return this.data[`${key}`] = value
        },

        signUp: function() {
            url = 'http://localhost/online-class/src/administrator/api/signup.php'
            fetch(url, {
                method: 'post',
                mode: 'cors',
                cache: 'no-cache',
                credentials: 'same-origin',
                headers: {
                    'Content-Type': 'application/json'
                },
                redirect: 'follow',
                referrerPolicy: 'no-referrer',
                body: JSON.stringify(this.data)
            })
            .then((response) => response.json())
            .then((responseJson) => {
                console.log(responseJson);
            })
        },
        
        handle: function () {
            $('.submit').on('click', () => {
                this.status = this.finalCheck()
                if(this.status) {
                    this.signUp()
                }
                else {
                    let err = $('.err')
                    err.css('display', 'flex')
                    setTimeout(() => {
                        err.css('display', 'none')
                    }, 2000);
                }
            })

            $('.choose-sex').on('click', () => {
                this.setData('gendle', $('.choose-sex').attr('data'))
            })

            $('.choose-type').on('click', () => {
                this.setData('type', $('.choose-type').attr('data'))
            })

            $('.content').on('change', () => {
                //Username
                let usrErr = $('.username_err')

                const reSet = () => {
                    this.setData('username', $('.username').val())
                    this.setData('password', md5($('.password').val()))
                    this.setData('address', $('.address').val())
                    this.setData('phone', $('.phone').val())
                    this.setData('major', $('.major').val())
                    this.setData('email', $('.email').val())
                    this.setData('fullname', $('.fullname').val())
                }

                reSet()
                //Username
                if(this.checkString(this.data.username) && (this.data.username.length >= 4) && (this.data.username.length < 16)) {
                    usrErr.html(null)
                }
                else {
                    usrErr.html('Tên tài khoản có độ dài 4 đến 16 và các kí tự 0 - 9, a - z!')
                }
                //Password
                let errPass = $('.password_err')
                if(this.data.password.length < 8 || this.data.password.length > 16) {
                    errPass.html('Mật khẩu phải có chiều dài từ 8 - 16 kí tự')
                }
                else {
                    errPass.html(null)
                }
                //Phone
                let errPhone = $('.phone_err')
                if(this.data.phone.length > 13) {
                    errPhone.html('Số điện thoại phải là số có chiều dài dưới 13 số')
                }
                else if (this.data.phone / 1 != this.data.phone) {
                        errPhone.html('Chỉ được chứa số')
                    }
                    else {
                        errPhone.html(null)
                    }
                // Email
                let errEmail = $('.email_err')
                let email = this.data.email
                if((email.slice(-10) == '@gmail.com') || (email.slice(-19) == '@student.ctu.edu.vn')){
                    errEmail.html(null)
                }
                else {
                    errEmail.html('Email phải có dạng @gmail.com hoặc @student.ctu.edu.com')
                }
                
            })
        },

        enforcement: function() {
            this.handle()
        }
    }

    information.enforcement()
    
    // Interface
    // document.querySelector('.submit').addEventListener('click', function(){
    //     document.querySelector('.capcha').classList.add('active')
    // })

    document.querySelector('.choose-file').addEventListener('click', function () {
        document.querySelector('.upload').click()
    })

    document.querySelector('.upload').addEventListener('change', function () {
        document.querySelector('.choose-file').innerHTML = document.querySelector('.upload').value
    })

    
    const chooseSexs = document.querySelectorAll('.choose-sex')
    for (item of chooseSexs) {
        item.addEventListener('click', function () {
            for (item of chooseSexs) {
                item.style.background = 'none'
                item.style.color = 'black'
            }
            this.style.backgroundImage = 'linear-gradient(90deg ,rgba(252, 107, 255), rgba(42, 96, 250))'
            this.style.opacity = '60%'
            this.style.color = 'white'
        })
    }
    const chooseTypes = document.querySelectorAll('.choose-type')
    for (item of chooseTypes) {
        item.addEventListener('click', function () {
            for (item of chooseTypes) {
                item.style.background = 'none'
                item.style.color = 'black'
            }
            this.style.backgroundImage = 'linear-gradient(90deg ,rgba(252, 107, 255), rgba(42, 96, 250))'
            this.style.opacity = '60%'
            this.style.color = 'white'
        })
    }
</script>

</html>